<script>
var PaperKit = PaperKit || {
  Behaviors: { },
  Tools: { }
};

PaperKit.Behaviors.DragContainerBehavior = {
  properties: {
  	dragSpot: {
  	  type: String,
  	  reflectToAttribute: true,
  	  value: ""
  	}  
  },
	ready: function() {
	  // Init properties
		this.draggedElement = null;
    this.dragStartBinding = this.dragStart.bind(this);
    this.dragEndBinding = this.dragEnd.bind(this);
    this.dragMoveBinding = this.dragMove.bind(this);

	  document.addEventListener('mousedown', this.dragStartBinding);
	  document.addEventListener('mouseup', this.dragEndBinding);
	},
	getDraggable: function(element) {
	  if(this.dragSpot && this.dragsSpot != "") {
	    if(element.classList.contains(this.dragSpot)) {
			  while (element) {
			    if(element.isDraggable) {
			      return element;
			    }
		      element = element.parentNode;
			  }
	    }
	 		return false;
	  } else {
	    if(element.isDraggable) {
	    	return element;  
	    }
	  }
	  return false;
	},
	dragStart: function(event) {
	  var el = this.getDraggable(event.target);
	  if(el) {
		  this.draggedElement = el;
      this.draggedElement.dragOffsetLeft = (event.clientX - this.draggedElement.offsetLeft);
      this.draggedElement.dragOffsetTop = (event.clientY - this.draggedElement.offsetTop);
      this.draggedElement.dragDeltaX = 0;
      this.draggedElement.dragDeltaY = 0;
      this.startDragging(this.draggedElement, event);
		  document.addEventListener('mousemove', this.dragMoveBinding); 
	  }
	},
	dragMove: function(event) {
	  if(this.draggedElement != null) {
      var left = event.clientX - this.draggedElement.dragOffsetLeft;
      var top = event.clientY - this.draggedElement.dragOffsetTop;      
      this.draggedElement.dragDeltaX = left - this.draggedElement.offsetLeft;
      this.draggedElement.dragDeltaY = top - this.draggedElement.offsetTop;
			this.draggedElement.style.left = left + "px";
			this.draggedElement.style.top = top + "px";

			this.doDragging(this.draggedElement, event);
	  }
	},
	dragEnd: function(event) {
	  if(this.draggedElement != null) {
	    document.removeEventListener('mousemove', this.dragMoveBinding);
	    this.endDragging(this.draggedElement, event);
	    
	    // Remove properties from element and set draggedElement to null;
	    delete this.draggedElement.dragOffsetLeft;
	    delete this.draggedElement.dragOffsetTop;
      delete this.draggedElement.dragDeltaX;
      delete this.draggedElement.dragDeltaY;
	    this.draggedElement = null;
	  }
	},
	// Overridable methods
	startDragging: function() {},
	doDragging: function() {},
	endDragging: function() {}	
};
</script>